<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tidywikidatar">
<title>Using Wikipedia as a starting point • tidywikidatar</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using Wikipedia as a starting point">
<meta property="og:description" content="tidywikidatar">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tidywikidatar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/caching.html">How caching works in tidywikidatar</a>
    <a class="dropdown-item" href="../articles/wikipedia_start.html">Using Wikipedia as a starting point</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="wikipedia_start_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Using Wikipedia as a starting point</h1>
            
      
      
      <div class="d-none name"><code>wikipedia_start.Rmd</code></div>
    </div>

    
    
<p>In the world of Wikidata, the most efficient way of getting data is usually through well-crafted <a href="https://www.wikidata.org/wiki/Wikidata:SPARQL_tutorial" class="external-link">SPARQL queries</a>. However, what is theoretically technically most efficient, may be highly impractical if someone is unfamiliar with the structure of such queries or with how they can be best applied to to get the most out of Wikidata.</p>
<p>Most people who turn to Wikidata will however be familiar with its more famous sister project, Wikipedia. As this post will explain, Wikipedia pages can be used as a starting point for getting data out of Wikidata.</p>
<div class="section level2">
<h2 id="setup-and-caching">Setup and caching<a class="anchor" aria-label="anchor" href="#setup-and-caching"></a>
</h2>
<p>An introductory note on caching. It is generally advisable to enable cache at the beginning of each script. Thanks to caching, when a block of code based on <code>tidywikidatar</code> is re-run it gives results almost instantly. But given that <code>tidywikidatar</code> queries for Wikidata items one at a time, it can be relatively time-consuming when it is run for the first time. So be patient when you run some of the commands below for the first time, and considering testing code with only a sample of the data at first (e.g. by adding something such as <code>slice_sample(n = 100)</code> to the data frame you use as a starting point).</p>
<p>Especially if you intend to use Wikidata in different projects, it may make sense to have the cache stored in a folder outside the current project. As the data can be recovered, it is usually unnecessary to backup the cache folder, and unwise to keep it in folder that are constantly synced with online services.</p>
<p>Most users should be perfectly fine using the default SQLite database for caching.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://edjnet.github.io/tidywikidatar/">"tidywikidatar"</a></span><span class="op">)</span>

<span class="fu"><a href="../reference/tw_enable_cache.html">tw_enable_cache</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/tw_set_cache_folder.html">tw_set_cache_folder</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_expand.html" class="external-link">path_home_r</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"R"</span>, <span class="st">"tw_data"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/tw_set_language.html">tw_set_language</a></span><span class="op">(</span>language <span class="op">=</span> <span class="st">"en"</span><span class="op">)</span>
<span class="fu"><a href="../reference/tw_create_cache_folder.html">tw_create_cache_folder</a></span><span class="op">(</span>ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>More advanced users, especially those relying on <code>tidywikidatar</code> in Shiny apps, may instead prefer relying on a MySql database, setting up the connection at the beginning of each session as follows.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://edjnet.github.io/tidywikidatar/">"tidywikidatar"</a></span><span class="op">)</span>

<span class="fu"><a href="../reference/tw_set_language.html">tw_set_language</a></span><span class="op">(</span>language <span class="op">=</span> <span class="st">"en"</span><span class="op">)</span>

<span class="fu"><a href="../reference/tw_enable_cache.html">tw_enable_cache</a></span><span class="op">(</span>SQLite <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="../reference/tw_set_cache_db.html">tw_set_cache_db</a></span><span class="op">(</span>driver <span class="op">=</span> <span class="st">"MySQL"</span>,
                host <span class="op">=</span> <span class="st">"localhost"</span>,
                port <span class="op">=</span> <span class="fl">3306</span>,
                database <span class="op">=</span> <span class="st">"tidywikidatar"</span>,
                user <span class="op">=</span> <span class="st">"secret_username"</span>,
                pwd <span class="op">=</span> <span class="st">"secret_password"</span><span class="op">)</span>


<span class="co"># for testing:</span>
<span class="co"># docker run --name tidywikidatar_db -p 3306:3306 -e MYSQL_ROOT_PASSWORD=secret_root_password -e MYSQL_USER=secret_username -e MYSQL_PASSWORD=secret_password -e MYSQL_DATABASE=tidywikidatar mysql:latest</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="members-of-the-european-parliament">Members of the European parliament<a class="anchor" aria-label="anchor" href="#members-of-the-european-parliament"></a>
</h2>
<p>Let’s suppose we are interested in finding details about the European Parliament and its members, and we do not want to approach SPARQL queries. We are, however, familiar with Wikipedia and we are happy to start from a Wikipedia page such as <a href="https://en.wikipedia.org/wiki/List_of_members_of_the_European_Parliament_(2019%E2%80%932024)" class="external-link">List of members of the European Parliament (2019–2024)</a>. It includes links to the Wikipedia pages of all Members of the European Parliament (MEPs), the party list from where they were elected at national level, the elections themselves, etc.</p>
<p>This is how we can take it from there with <code>tidywikidatar</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mep_wiki_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tw_get_wikipedia_page_links.html">tw_get_wikipedia_page_links</a></span><span class="op">(</span>
  url <span class="op">=</span> <span class="st">"https://en.wikipedia.org/wiki/List_of_members_of_the_European_Parliament_(2019–2024)"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">mep_wiki_df</span><span class="op">)</span>
<span class="co">#&gt; tibble [1,393 × 8] (S3: tbl_df/tbl/data.frame)</span>
<span class="co">#&gt;  $ source_title_url      : chr [1:1393] "List_of_members_of_the_European_Parliament_(2019–2024)" "List_of_members_of_the_European_Parliament_(2019–2024)" "List_of_members_of_the_European_Parliament_(2019–2024)" "List_of_members_of_the_European_Parliament_(2019–2024)" ...</span>
<span class="co">#&gt;  $ source_wikipedia_title: chr [1:1393] "List of members of the European Parliament (2019–2024)" "List of members of the European Parliament (2019–2024)" "List of members of the European Parliament (2019–2024)" "List of members of the European Parliament (2019–2024)" ...</span>
<span class="co">#&gt;  $ source_qid            : chr [1:1393] "Q55619306" "Q55619306" "Q55619306" "Q55619306" ...</span>
<span class="co">#&gt;  $ wikipedia_title       : chr [1:1393] "1979 European Parliament election" "1984 European Parliament election" "1989 European Parliament election" "1994 European Parliament election" ...</span>
<span class="co">#&gt;  $ wikipedia_id          : int [1:1393] 9737190 9737225 9736812 9736512 294038 433911 5966954 23194184 42869480 60699754 ...</span>
<span class="co">#&gt;  $ qid                   : chr [1:1393] "Q1376068" "Q1376075" "Q1376076" "Q1376071" ...</span>
<span class="co">#&gt;  $ description           : chr [1:1393] "First election to the European Parliament" "Election to the European Parliament" "Election to the European Parliament" "Election to the European Parliament" ...</span>
<span class="co">#&gt;  $ language              : chr [1:1393] "en" "en" "en" "en" ...</span></code></pre></div>
<p>What kind of things are mentioned in this page?</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mep_wiki_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">qid</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/tw_get_property.html">tw_get_property</a></span><span class="op">(</span>p <span class="op">=</span> <span class="st">"P31"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">tally</a></span><span class="op">(</span>sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">transmute</a></span><span class="op">(</span>instance_of <span class="op">=</span> <span class="fu"><a href="../reference/tw_get_label.html">tw_get_label</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,
            <span class="va">n</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 67 × 2</span>
<span class="co">#&gt;    instance_of                                    n</span>
<span class="co">#&gt;    &lt;chr&gt;                                      &lt;int&gt;</span>
<span class="co">#&gt;  1 human                                        819</span>
<span class="co">#&gt;  2 Wikimedia list article                       227</span>
<span class="co">#&gt;  3 political party                              161</span>
<span class="co">#&gt;  4 &lt;NA&gt;                                          62</span>
<span class="co">#&gt;  5 election to the European Parliament           35</span>
<span class="co">#&gt;  6 political party in Germany                    13</span>
<span class="co">#&gt;  7 Green party                                   13</span>
<span class="co">#&gt;  8 political group of the European Parliament     8</span>
<span class="co">#&gt;  9 Wikimedia project page                         6</span>
<span class="co">#&gt; 10 electoral alliance                             6</span>
<span class="co">#&gt; # … with 57 more rows</span></code></pre></div>
<p>It’s mostly humans - likely, mostly MEPs themselves, but also political parties, elections, and other Wikipedia page lists.</p>
<p>We can filter results in order to keep only humans as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">humans_df</span> <span class="op">&lt;-</span> <span class="va">mep_wiki_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">qid</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/tw_get_property.html">tw_get_property</a></span><span class="op">(</span>p <span class="op">=</span> <span class="st">"P31"</span><span class="op">)</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># instance of</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">value</span> <span class="op">==</span> <span class="st">"Q5"</span><span class="op">)</span> <span class="co"># human</span>

<span class="va">meps_df</span> <span class="op">&lt;-</span> <span class="va">humans_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/tw_get_property.html">tw_get_property</a></span><span class="op">(</span>p <span class="op">=</span> <span class="st">"P39"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># position held</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">value</span> <span class="op">==</span> <span class="st">"Q27169"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># keep only MEPs</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></code></pre></div>
<p>It appears we have 819 humans, and 805 among them who have been members of the European Parliament mentioned in this page. Perhaps some of those mentioned in the page are people who never took their place, or perhaps MEPs in previous legislatures?</p>
<p>To get a step closer to clarifying this, we can check the qualifiers of a property. So if you look at the property <a href="https://www.wikidata.org/wiki/Q2391857#P39" class="external-link">“position held” for a member of the European Parliament (2019-2024)</a>, you may notice that the “position held” -&gt; “member of the European Parliament” has a few qualifiers, including “parliamentary term” which may have value “Ninth European Parliament”.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">meps9_df</span> <span class="op">&lt;-</span> <span class="va">meps_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/tw_get_qualifiers.html">tw_get_qualifiers</a></span><span class="op">(</span>p <span class="op">=</span> <span class="st">"P39"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">qualifier_property</span> <span class="op">==</span> <span class="st">"P2937"</span>,
         <span class="va">qualifier_value</span> <span class="op">==</span> <span class="st">"Q64038205"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></code></pre></div>
<p>It appears that 801 have actually been members of the “Ninth European Parliament”.</p>
<p>Out of curiosity, and as a quality check, let’s see who are the MEPs mentioned in the page who <em>have not</em> been members of the ninth legislature.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">meps_df</span>,
          <span class="va">meps9_df</span>,
          by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="../reference/tw_get_label.html">tw_get_label</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4 × 2</span>
<span class="co">#&gt;   id        name              </span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;             </span>
<span class="co">#&gt; 1 Q312901   Josep Borrell     </span>
<span class="co">#&gt; 2 Q11769926 Mariya Gabriel    </span>
<span class="co">#&gt; 3 Q1055449  Matteo Salvini    </span>
<span class="co">#&gt; 4 Q57630    Valdis Dombrovskis</span></code></pre></div>
<p>Indeed, all of them gave up their seat for one reason or another.</p>
<p>As we have reason to believe the Wikipedia page we have used as a starting point is reasonably complete, we can now proceed assuming that we now a reasonably complete list of MEPs of the ninth legislature. We can then take it as a starting point for all sorts questions, such as which position they held before becoming MEPs (or at the same time as being MEPs), or who among them joined the European Parliament after the beginning of the legislature. This is, for example, a list of MEPs who joined the parliament only in 2021, and with reference to whom did they replace:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">replacing_meps_df</span> <span class="op">&lt;-</span> <span class="va">meps9_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/tw_get_qualifiers.html">tw_get_qualifiers</a></span><span class="op">(</span>p <span class="op">=</span> <span class="st">"P39"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">qualifier_id</span> <span class="op">==</span> <span class="st">"Q27169"</span>, <span class="co"># member of the european parliament</span>
         <span class="va">qualifier_property</span> <span class="op">==</span> <span class="st">"P580"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># start time</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">qualifier_value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_starts</a></span><span class="op">(</span><span class="va">qualifier_value</span>, <span class="st">"\\+2021"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="../reference/tw_get_qualifiers.html">tw_get_qualifiers</a></span><span class="op">(</span>p <span class="op">=</span> <span class="st">"P39"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">qualifier_id</span> <span class="op">==</span> <span class="st">"Q27169"</span>, <span class="co"># member of the european parliament</span>
         <span class="va">qualifier_property</span> <span class="op">==</span> <span class="st">"P1365"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># replaces</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">transmute</a></span><span class="op">(</span>new_mep_id <span class="op">=</span> <span class="va">id</span>,
            new_mep <span class="op">=</span> <span class="fu"><a href="../reference/tw_get_label.html">tw_get_label</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,
            previous_mep_id <span class="op">=</span> <span class="va">qualifier_value</span>,
            previous_mep <span class="op">=</span> <span class="fu"><a href="../reference/tw_get_label.html">tw_get_label</a></span><span class="op">(</span><span class="va">qualifier_value</span><span class="op">)</span><span class="op">)</span>

<span class="va">replacing_meps_df</span>
<span class="co">#&gt; # A tibble: 9 × 4</span>
<span class="co">#&gt;   new_mep_id new_mep                       previous_mep_id previous_mep     </span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;                         &lt;chr&gt;           &lt;chr&gt;            </span>
<span class="co">#&gt; 1 Q108904462 Karolin Braunsberger-Reinhold Q17093506       Sven Schulze     </span>
<span class="co">#&gt; 2 Q22443735  João Pimenta Lopes            Q1671880        Inês Zuber       </span>
<span class="co">#&gt; 3 Q22443735  João Pimenta Lopes            Q11728715       João Ferreira    </span>
<span class="co">#&gt; 4 Q106519771 Michiel Hoogeveen             Q979348         Derk Jan Eppink  </span>
<span class="co">#&gt; 5 Q106518433 Thijs Reuten                  Q17143453       Kati Piri        </span>
<span class="co">#&gt; 6 Q104126196 Emma Wiesner                  Q513301         Fredrick Federley</span>
<span class="co">#&gt; 7 Q18225970  Tom Vandenkendelaere          Q270530         Marianne Thyssen </span>
<span class="co">#&gt; 8 Q18225970  Tom Vandenkendelaere          Q12869          Kris Peeters     </span>
<span class="co">#&gt; 9 Q63224243  Ernő Schaller-Baross          Q731042         József Szájer</span></code></pre></div>
<p>Curiously, we find that there are two current MEPs who have replaced a colleague after the beginning of the legislature more than once. Can we confirm in which legislatures those who have replaced a colleague more than once have served as MEPs? Of course.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">replacing_meps_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">new_mep_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">new_mep_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/tw_get_qualifiers.html">tw_get_qualifiers</a></span><span class="op">(</span>p <span class="op">=</span> <span class="st">"P39"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">qualifier_property</span> <span class="op">==</span> <span class="st">"P2937"</span>, <span class="co"># parliamentary term</span>
         <span class="va">qualifier_id</span> <span class="op">==</span> <span class="st">"Q27169"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># as MEP</span>
  <span class="fu"><a href="../reference/tw_label.html">tw_label</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">transmute</a></span><span class="op">(</span>mep <span class="op">=</span> <span class="va">id</span>, legislature <span class="op">=</span> <span class="va">qualifier_value</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4 × 2</span>
<span class="co">#&gt;   mep                  legislature               </span>
<span class="co">#&gt;   &lt;chr&gt;                &lt;chr&gt;                     </span>
<span class="co">#&gt; 1 Tom Vandenkendelaere Eighth European Parliament</span>
<span class="co">#&gt; 2 Tom Vandenkendelaere Ninth European Parliament </span>
<span class="co">#&gt; 3 João Pimenta Lopes   Eighth European Parliament</span>
<span class="co">#&gt; 4 João Pimenta Lopes   Ninth European Parliament</span></code></pre></div>
<p>This <a href="https://medium.com/european-data-journalism-network/a-new-r-package-for-exploring-the-wealth-of-information-stored-by-wikidata-fe85e82b6440" class="external-link">blog post</a> presents some examples of the way Wikidata works based on MEPs, and they can easily be replicated taking it from here.</p>
<p>Let’s make some more examples.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">meps9_pob_df</span> <span class="op">&lt;-</span> <span class="va">meps9_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mep <span class="op">=</span> <span class="fu"><a href="../reference/tw_get_label.html">tw_get_label</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>place_of_birth_id <span class="op">=</span> <span class="fu"><a href="../reference/tw_get_property_same_length.html">tw_get_p</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">id</span>, p <span class="op">=</span> <span class="st">"P19"</span>, only_first <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>place_of_birth <span class="op">=</span> <span class="fu"><a href="../reference/tw_get_label.html">tw_get_label</a></span><span class="op">(</span><span class="va">place_of_birth_id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>place_of_birth_coordinates <span class="op">=</span> <span class="fu"><a href="../reference/tw_get_property_same_length.html">tw_get_p</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">place_of_birth_id</span>,
                                               p <span class="op">=</span> <span class="st">"P625"</span>,
                                               only_first <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
      <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span>
      col <span class="op">=</span> <span class="va">place_of_birth_coordinates</span>,
      into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
        <span class="st">"pob_latitude"</span>,
        <span class="st">"pob_longitude"</span>
      <span class="op">)</span>,
      sep <span class="op">=</span> <span class="st">","</span>,
      remove <span class="op">=</span> <span class="cn">TRUE</span>,
      convert <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">pob_latitude</span><span class="op">)</span><span class="op">==</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>We have a place of birth on the records for 795 MEPs out of 801. Not bad. We could use some proxy for the cases when such information is unavailable, for example using properties such as “residence” (<a href="https://www.wikidata.org/wiki/Property:P551" class="external-link">P551</a>) or the earliest place where they got their education, but for the time being we will leave it at that.</p>
<p>We could now easily place these data on a map (code example not run to remove dependency on external files and packages).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">world_sf_file</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="st">"world_geo_data"</span>, <span class="st">"world_sf.rds"</span><span class="op">)</span>

<span class="kw">if</span> <span class="op">(</span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_access.html" class="external-link">file_exists</a></span><span class="op">(</span><span class="va">world_sf_file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">world_sf</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span><span class="va">world_sf_file</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/create.html" class="external-link">dir_create</a></span><span class="op">(</span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="st">"world_geo_data"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>
    url <span class="op">=</span> <span class="st">"https://gisco-services.ec.europa.eu/distribution/v2/countries/download/ref-countries-2020-60m.geojson.zip"</span>,
    destfile <span class="op">=</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="st">"world_geo_data"</span>, <span class="st">"world.geojson.zip"</span><span class="op">)</span>
  <span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="st">"world_geo_data"</span>, <span class="st">"world.geojson.zip"</span><span class="op">)</span>,
        exdir <span class="op">=</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="st">"world_geo_data"</span><span class="op">)</span>
  <span class="op">)</span>

  <span class="va">world_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_read</span><span class="op">(</span>dsn <span class="op">=</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="st">"world_geo_data"</span>, <span class="st">"CNTR_RG_60M_2020_4326.geojson"</span><span class="op">)</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">world_sf</span>, file <span class="op">=</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="st">"world_geo_data"</span>, <span class="st">"world_sf.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>


<span class="va">meps9_pob_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_as_sf</span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pob_longitude"</span>, <span class="st">"pob_latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">world_sf</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>And we can notice that quite a few MEPs were not born in an EU country. We could then geocode the locations, or ask Wikidata in which country their place of birth is located.</p>
<p>Here we already start to meet some of the quirks of Wikidata.</p>
<p>The question “in which country is this city located” seems straightforward, but as illustrated <a href="https://edjnet.github.io/tidywikidatar/#getting-the-right-property-when-more-than-one-is-available">in the package readme</a> it actually isn’t always the case, as, for example, London has many values for the property “country”, all the way from “Roman Empire” through “United Kingdom”. Enabling the <code>only_first</code> parameters, which is a the most efficient option in many circumstances, is not a sensible solution in this case, as predicting the order of properties is not straightforward.</p>
<p>To make things easier in such circumstances <code>tidywikidatar</code> includes dedicated parameters: <code>preferred</code> (which gives back the value recorded as “preferred”), and <code>latest_start_time</code> (which checks the qualifiers, and selects the one with the most recent “start time”).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">meps9_pob_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pob_country_id <span class="op">=</span> <span class="fu"><a href="../reference/tw_get_property_same_length.html">tw_get_p</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">place_of_birth_id</span>,
                                   p <span class="op">=</span> <span class="st">"P17"</span>,
                                   only_first <span class="op">=</span> <span class="cn">TRUE</span>,
                                   preferred <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">pob_country_id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">tally</a></span><span class="op">(</span>sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pob_country <span class="op">=</span> <span class="fu"><a href="../reference/tw_get_label.html">tw_get_label</a></span><span class="op">(</span><span class="va">pob_country_id</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 58 × 3</span>
<span class="co">#&gt;    pob_country_id     n pob_country   </span>
<span class="co">#&gt;    &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;         </span>
<span class="co">#&gt;  1 Q183              95 Germany       </span>
<span class="co">#&gt;  2 Q38               78 Italy         </span>
<span class="co">#&gt;  3 Q142              77 France        </span>
<span class="co">#&gt;  4 Q145              60 United Kingdom</span>
<span class="co">#&gt;  5 Q29               56 Spain         </span>
<span class="co">#&gt;  6 Q36               50 Poland        </span>
<span class="co">#&gt;  7 Q218              34 Romania       </span>
<span class="co">#&gt;  8 Q55               30 Netherlands   </span>
<span class="co">#&gt;  9 Q31               23 Belgium       </span>
<span class="co">#&gt; 10 Q213              22 Czech Republic</span>
<span class="co">#&gt; # … with 48 more rows</span></code></pre></div>
<p>Keep in mind that enabling <code>latest_start_time</code> has an impact on processing time (as it relies on <code><a href="../reference/tw_get_qualifiers.html">tw_get_qualifiers()</a></code> which caches data separately), but that enabling <code>preferred</code> is just as fast as having it disabled.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Giorgio Comai, EDJNet.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
